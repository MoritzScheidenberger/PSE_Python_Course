<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.55">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Moritz Scheidenberger">

<title> Writing a Story</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="main_quarto_files/libs/clipboard/clipboard.min.js"></script>
<script src="main_quarto_files/libs/quarto-html/quarto.js"></script>
<script src="main_quarto_files/libs/quarto-html/popper.min.js"></script>
<script src="main_quarto_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="main_quarto_files/libs/quarto-html/anchor.min.js"></script>
<link href="main_quarto_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="main_quarto_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="main_quarto_files/libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="main_quarto_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="main_quarto_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="main_quarto_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="main_quarto_files/libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script src="main_quarto_files/libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="main_quarto_files/libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="main_quarto_files/libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<style>html{ scroll-behavior: smooth; }</style>
<style>

      .quarto-title-block .quarto-title-banner h1,
      .quarto-title-block .quarto-title-banner h2,
      .quarto-title-block .quarto-title-banner h3,
      .quarto-title-block .quarto-title-banner h4,
      .quarto-title-block .quarto-title-banner h5,
      .quarto-title-block .quarto-title-banner h6
      {
        color: white;
      }

      .quarto-title-block .quarto-title-banner {
        color: white;
background: #921539;
      }
</style>


<link rel="stylesheet" href="main_quarto_files/costum_style.css">
</head>

<body>

<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title"><p><img src="main_quarto_files/pse_logo.png" class="img-fluid" style="float: right; width: 100px;"> Writing a Story</p></h1>
            <p class="subtitle lead">Understanding the Impact of Uncertainty on Replacement Hiring</p>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Moritz Scheidenberger </p>
            </div>
    </div>
      
    
      <div>
      <div class="quarto-title-meta-heading">Modified</div>
      <div class="quarto-title-meta-contents">
        <p class="date-modified">February 15, 2025</p>
      </div>
    </div>
      
    </div>
    
  <div>
    <div class="abstract">
      <div class="block-title">Abstract</div>
      In the labor market, transitions in and out of unemployment are driven by two wheels. One wheel is the classical cycle of job creation and job destruction. Firms create jobs for which they hire unemployed workers. Simulatenously, some already filled jobs are destroyed and the associated workers become unemployed. The second wheel is driven by churn. Some already employed workers are hired by another firm and leave behind an empty position which, subsequently, may be filled by another already employed worker who themselves leaves behind a position. So the churn wheel keeps turning until the empty position is filled by a previously unemployed worker. The conventional view is that models of the labor market model can abstract from the churn wheel when mainly interested in unemployment dynamics. Since job creation must equal job destruction, the number of UE transitions is determined by the EU transitions. EE transitions offset eachother and do not matter for unemploymend dynamics. Yet, disregarding replacement hiring dynamics risks missing essential labor market effects when economic shocks alter firms’ quit replacement decisions through mechanisms beyond the usual business cycle impact. I provide novel evidence that uncertainty shocks directly impact firms’ replacement hiring decisions. The reluctance to rehire under uncertainty arises because firms treat existing positions as valuable but sunk investments, leading to a wait-and-see approach.
    </div>
  </div>
  
  </header><div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Contents</h2>
   
  <ul>
  <li><a href="#data-and-methodology" id="toc-data-and-methodology" class="nav-link active" data-scroll-target="#data-and-methodology"><span class="header-section-number">1</span> Data and Methodology</a>
  <ul class="collapse">
  <li><a href="#file-naming-convention-for-lehd-data" id="toc-file-naming-convention-for-lehd-data" class="nav-link" data-scroll-target="#file-naming-convention-for-lehd-data"><span class="header-section-number">1.1</span> File Naming Convention for LEHD Data</a></li>
  <li><a href="#first-analysis" id="toc-first-analysis" class="nav-link" data-scroll-target="#first-analysis"><span class="header-section-number">1.2</span> First Analysis</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content quarto-banner-title-block" id="quarto-document-content">





<section id="data-and-methodology" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Data and Methodology</h1>
<section id="file-naming-convention-for-lehd-data" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="file-naming-convention-for-lehd-data"><span class="header-section-number">1.1</span> File Naming Convention for LEHD Data</h2>
<p>The LEHD provides various data sets for the US based on Census data. …</p>
<details>
<summary>
<strong>LEHD Data Naming Convention</strong> (Click to Expand)
</summary>
<table class="caption-top table">
<colgroup>
<col style="width: 35%">
<col style="width: 23%">
<col style="width: 41%">
</colgroup>
<thead>
<tr class="header">
<th><strong>Component</strong></th>
<th><strong>Code</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>GEOHI (Geography Identifier)</strong></td>
<td><code>all</code></td>
<td>All available states</td>
</tr>
<tr class="even">
<td></td>
<td><code>us</code></td>
<td>National data (50 states + DC)</td>
</tr>
<tr class="odd">
<td></td>
<td><code>metro</code></td>
<td>CBSA-level collection (metropolitan areas)</td>
</tr>
<tr class="even">
<td></td>
<td><code>[st]</code></td>
<td>Two-letter state postal code (e.g., <code>ca</code> for California)</td>
</tr>
<tr class="odd">
<td></td>
<td><code>[NNNNN]</code></td>
<td>CBSA-derived code for metro areas</td>
</tr>
<tr class="even">
<td><strong>DEMO (Demographic Breakdown)</strong></td>
<td><code>d</code></td>
<td>No demographic detail</td>
</tr>
<tr class="odd">
<td></td>
<td><code>rh</code></td>
<td>Race by Ethnicity</td>
</tr>
<tr class="even">
<td></td>
<td><code>sa</code></td>
<td>Sex by Age</td>
</tr>
<tr class="odd">
<td></td>
<td><code>se</code></td>
<td>Sex by Education</td>
</tr>
<tr class="even">
<td></td>
<td><code>sarhe</code></td>
<td>Combined <code>sa</code>, <code>rh</code>, and <code>se</code></td>
</tr>
<tr class="odd">
<td><strong>FAS (Firm Age &amp; Size Breakdown)</strong></td>
<td><code>f</code></td>
<td>No firm size or age breakdown</td>
</tr>
<tr class="even">
<td></td>
<td><code>fa</code></td>
<td>Firm age tabulations</td>
</tr>
<tr class="odd">
<td></td>
<td><code>fs</code></td>
<td>Firm size tabulations</td>
</tr>
<tr class="even">
<td><strong>GEOCAT (Geographic Category)</strong></td>
<td><code>gb</code></td>
<td>Metropolitan (complete)</td>
</tr>
<tr class="odd">
<td></td>
<td><code>gc</code></td>
<td>Counties</td>
</tr>
<tr class="even">
<td></td>
<td><code>gm</code></td>
<td>Metropolitan/Micropolitan (state parts)</td>
</tr>
<tr class="odd">
<td></td>
<td><code>gn</code></td>
<td>National (50 States + DC)</td>
</tr>
<tr class="even">
<td></td>
<td><code>gs</code></td>
<td>States</td>
</tr>
<tr class="odd">
<td></td>
<td><code>gw</code></td>
<td>Workforce Investment Areas</td>
</tr>
<tr class="even">
<td><strong>INDCAT (Industry Classification)</strong></td>
<td><code>n</code></td>
<td>All industries</td>
</tr>
<tr class="odd">
<td></td>
<td><code>ns</code></td>
<td>NAICS sectors</td>
</tr>
<tr class="even">
<td></td>
<td><code>n3</code></td>
<td>NAICS subsectors</td>
</tr>
<tr class="odd">
<td></td>
<td><code>n4</code></td>
<td>NAICS industry groups</td>
</tr>
<tr class="even">
<td><strong>OWNCAT (Ownership Classification)</strong></td>
<td><code>of</code></td>
<td>Federal Government</td>
</tr>
<tr class="odd">
<td></td>
<td><code>op</code></td>
<td>All Private</td>
</tr>
<tr class="even">
<td></td>
<td><code>oslp</code></td>
<td>State, Local, and Private ownership</td>
</tr>
<tr class="odd">
<td><strong>SA (Seasonal Adjustment)</strong></td>
<td><code>s</code></td>
<td>Seasonally adjusted</td>
</tr>
<tr class="even">
<td></td>
<td><code>u</code></td>
<td>Not seasonally adjusted</td>
</tr>
<tr class="odd">
<td><strong>EXT (File Format)</strong></td>
<td><code>csv</code></td>
<td>Comma-Separated file</td>
</tr>
<tr class="even">
<td></td>
<td><code>pdf</code></td>
<td>Printable PDF</td>
</tr>
<tr class="odd">
<td></td>
<td><code>xls</code></td>
<td>Excel (limited availability)</td>
</tr>
<tr class="even">
<td></td>
<td><code>xlsx</code></td>
<td>Excel (not available for large files)</td>
</tr>
</tbody>
</table>
<p><em>Source: <a href="https://lehd.ces.census.gov/data/schema/V4.12.0/lehd_csv_naming.html">LEHD CSV Naming Convention</a></em></p>
<p><strong>Quick Example Breakdown</strong> - <strong>qwi</strong> → Quarterly Workforce Indicators (QWI) Counts - <strong>us</strong> → National-level data - <strong>sa</strong> → Sex by Age - <strong>f</strong> → No firm size or age breakdown - <strong>gn</strong> → National (50 states + DC) - <strong>ns</strong> → NAICS sectors - <strong>op</strong> → All Private ownership - <strong>u</strong> → Not seasonally adjusted</p>
</details>
<p><span style="color: red;"><strong>Note: National QWI data is only available for Private ownership!</strong></span></p>
<hr>
<div id="obtain_data" class="cell" data-execution_count="2">
<div class="cell-output cell-output-stdout">
<pre><code>Data downloaded &amp; extracted successfully.</code></pre>
</div>
</div>
<hr>
<p>Now let’s take a quick look at the data to know what we are working with and how to proceed.</p>
<div id="select_data" class="cell" data-execution_count="3">
<div class="cell-output cell-output-stdout">
<pre><code>Column Names (formatted):
periodicity | seasonadj | geo_level | geography | ind_level | industry | ownercode | sex | agegrp |
race | ethnicity | education | firmage | firmsize | year | quarter | Emp | EmpEnd | EmpS | EmpTotal
| EmpSpv | HirA | HirN | HirR | Sep | HirAEnd | SepBeg | HirAEndRepl | HirAEndR | SepBegR |
HirAEndReplR | HirAS | HirNS | SepS | SepSnx | TurnOvrS | FrmJbGn | FrmJbLs | FrmJbC | FrmJbGnS |
FrmJbLsS | FrmJbCS | EarnS | EarnBeg | EarnHirAS | EarnHirNS | EarnSepS | Payroll | sEmp | sEmpEnd |
sEmpS | sEmpTotal | sEmpSpv | sHirA | sHirN | sHirR | sSep | sHirAEnd | sSepBeg | sHirAEndRepl |
sHirAEndR | sSepBegR | sHirAEndReplR | sHirAS | sHirNS | sSepS | sSepSnx | sTurnOvrS | sFrmJbGn |
sFrmJbLs | sFrmJbC | sFrmJbGnS | sFrmJbLsS | sFrmJbCS | sEarnS | sEarnBeg | sEarnHirAS | sEarnHirNS
| sEarnSepS | sPayroll
seasonadj: U
geo_level: N
ind_level: A, S
industry: 00, 11, 21, 22, 23, 31-33, 42, 44-45, 48-49, 51, 52, 53, 54, 55, 56, 61, 62, 71, 72, 81
ownercode: A05
sex: 0, 1, 2
agegrp: A00, A01, A02, A03, A04, A05, A06, A07, A08
race: A0
ethnicity: A0
education: E0
firmage: 0
firmsize: 0</code></pre>
</div>
</div>
<p>Now that we can see the data and know which variables have various cateogries, we can proceed by extracting the time series that we are most interested in.</p>
<p>The variables typically contained in the QWI data follow in a table below:</p>
<details>
<summary>
<strong>Variables Table</strong> (Click to Expand)
</summary>
<table class="caption-top table">
<colgroup>
<col style="width: 19%">
<col style="width: 15%">
<col style="width: 13%">
<col style="width: 15%">
<col style="width: 13%">
<col style="width: 7%">
<col style="width: 9%">
<col style="width: 6%">
</colgroup>
<thead>
<tr class="header">
<th>Indicator Variable</th>
<th>Alternate Name</th>
<th>Status Flag</th>
<th>Indicator Name</th>
<th>Description</th>
<th>Units</th>
<th>Concept</th>
<th>Base</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Emp</td>
<td>B</td>
<td>sEmp</td>
<td>Beginning-of-Quarter Employment</td>
<td>Estimate of the total number of jobs on the first day of the reference quarter</td>
<td>Count</td>
<td>Employment</td>
<td>1</td>
</tr>
<tr class="even">
<td>EmpEnd</td>
<td>E</td>
<td>sEmpEnd</td>
<td>End-of-Quarter Employment</td>
<td>Estimate of the number of jobs on the last day of the quarter</td>
<td>Count</td>
<td>Employment</td>
<td>1</td>
</tr>
<tr class="odd">
<td>EmpS</td>
<td>F</td>
<td>sEmpS</td>
<td>Full-Quarter Employment (Stable)</td>
<td>Estimate of stable jobs - the number of jobs that are held on both the first and last day of the quarter with the same employer</td>
<td>Count</td>
<td>Employment</td>
<td>1</td>
</tr>
<tr class="even">
<td>EmpTotal</td>
<td>M</td>
<td>sEmpTotal</td>
<td>Employment - Reference Quarter</td>
<td>Estimated count of people employed in a firm at any time during the quarter</td>
<td>Count</td>
<td>Employment</td>
<td>1</td>
</tr>
<tr class="odd">
<td>EmpSpv</td>
<td>Fpv</td>
<td>sEmpSpv</td>
<td>Full-Quarter Employment in the Previous Quarter</td>
<td>Estimate of stable jobs in the quarter before the reference quarter</td>
<td>Count</td>
<td>Employment</td>
<td>1</td>
</tr>
<tr class="even">
<td>HirA</td>
<td>A</td>
<td>sHirA</td>
<td>Hires (All Accessions)</td>
<td>Estimated number of workers who started a new job in the specified quarter</td>
<td>Count</td>
<td>Hire</td>
<td>1</td>
</tr>
<tr class="odd">
<td>HirN</td>
<td>H</td>
<td>sHirN</td>
<td>New Hires</td>
<td>Estimated number of workers who started a new job excluding recall hires</td>
<td>Count</td>
<td>Hire</td>
<td>1</td>
</tr>
<tr class="even">
<td>HirR</td>
<td>R</td>
<td>sHirR</td>
<td>Recall Hires</td>
<td>Estimated number of workers who returned to the same employer where they had worked within the previous year</td>
<td>Count</td>
<td>Hire</td>
<td>1</td>
</tr>
<tr class="odd">
<td>Sep</td>
<td>S</td>
<td>sSep</td>
<td>Separations (All)</td>
<td>Estimated number of workers whose job with a given employer ended in the specified quarter</td>
<td>Count</td>
<td>Separation</td>
<td>1</td>
</tr>
<tr class="even">
<td>HirAEnd</td>
<td>CA</td>
<td>sHirAEnd</td>
<td>End-of-Quarter Hires</td>
<td>Estimated number of workers who started a new job in the specified quarter, which continued into next quarter</td>
<td>Count</td>
<td>Hire</td>
<td>1</td>
</tr>
<tr class="odd">
<td>SepBeg</td>
<td>CS</td>
<td>sSepBeg</td>
<td>Beginning-of-Quarter Separations</td>
<td>Estimated number of workers whose job in the previous quarter continued and ended in the given quarter</td>
<td>Count</td>
<td>Separation</td>
<td>1</td>
</tr>
<tr class="even">
<td>HirAEndRepl</td>
<td>EI</td>
<td>sHirAEndRepl</td>
<td>Replacement Hires</td>
<td>Hires into continuous quarter employment in excess of job creation</td>
<td>Count</td>
<td>Hire</td>
<td>1</td>
</tr>
<tr class="odd">
<td>HirAEndR</td>
<td>CAR</td>
<td>sHirAEndR</td>
<td>End-of-Quarter Hiring Rate</td>
<td>Hires as a percent of average employment</td>
<td>Rate</td>
<td>Hire</td>
<td>(Emp + EmpEnd)/2</td>
</tr>
<tr class="even">
<td>SepBegR</td>
<td>CSR</td>
<td>sSepBegR</td>
<td>Beginning-of-Quarter Separation Rate</td>
<td>Separations as a percent of average employment</td>
<td>Rate</td>
<td>Separation</td>
<td>(Emp + EmpEnd)/2</td>
</tr>
<tr class="odd">
<td>HirAEndReplR</td>
<td>EIR</td>
<td>sHirAEndReplR</td>
<td>Replacement Hiring Rate</td>
<td>Replacement hires as a percent of the average of beginning- and end-of-quarter employment</td>
<td>Rate</td>
<td>Hire</td>
<td>(Emp + EmpEnd)/2</td>
</tr>
<tr class="even">
<td>HirAS</td>
<td>FA</td>
<td>sHirAS</td>
<td>Hires (All Hires into Full-Quarter Employment)</td>
<td>Estimated number of workers that started a job that lasted at least one full quarter with a given employer</td>
<td>Count</td>
<td>Hire</td>
<td>1</td>
</tr>
<tr class="odd">
<td>HirNS</td>
<td>FH</td>
<td>sHirNS</td>
<td>New Hires (New Hires into Full-Quarter Employment)</td>
<td>Estimated number of workers who started a job that they had not held within the past year and the job turned into a job that lasted at least a full quarter with a given employer</td>
<td>Count</td>
<td>Hire</td>
<td>1</td>
</tr>
<tr class="even">
<td>SepS</td>
<td>FS</td>
<td>sSepS</td>
<td>Separations (Flows out of Full-Quarter Employment)</td>
<td>Estimated number of workers who had a job for at least a full quarter and then the job ended</td>
<td>Count</td>
<td>Separation</td>
<td>1</td>
</tr>
<tr class="odd">
<td>SepSnx</td>
<td>FSnx</td>
<td>sSepSnx</td>
<td>Separations in the Next Quarter (Flows out of Full-Quarter Employment)</td>
<td>Estimated number of workers in the next quarter who had a job for at least a full quarter and then the job ended</td>
<td>Count</td>
<td>Separation</td>
<td>1</td>
</tr>
<tr class="even">
<td>TurnOvrS</td>
<td>FT</td>
<td>sTurnOvrS</td>
<td>Turnover (Stable)</td>
<td>The rate at which stable jobs begin and end</td>
<td>Rate</td>
<td>Turnover</td>
<td>2*EmpS</td>
</tr>
<tr class="odd">
<td>FrmJbGn</td>
<td>JC</td>
<td>sFrmJbGn</td>
<td>Firm Job Gains (Job Creation)</td>
<td>Estimated number of jobs gained at firms throughout the quarter</td>
<td>Count</td>
<td>Job Flows</td>
<td>1</td>
</tr>
<tr class="even">
<td>FrmJbLs</td>
<td>JD</td>
<td>sFrmJbLs</td>
<td>Firm Job Loss (Job Destruction)</td>
<td>Estimated number of jobs lost at firms throughout the quarter</td>
<td>Count</td>
<td>Job Flows</td>
<td>1</td>
</tr>
<tr class="odd">
<td>FrmJbC</td>
<td>JF</td>
<td>sFrmJbC</td>
<td>Firm Job Change (Net Change)</td>
<td>Difference between firm job gain and firm job loss</td>
<td>Count</td>
<td>Job Flows</td>
<td>1</td>
</tr>
<tr class="even">
<td>FrmJbGnS</td>
<td>FJC</td>
<td>sFrmJbGnS</td>
<td>Firm Job Gains (Stable)</td>
<td>Estimated number of full-quarter jobs gained at firms</td>
<td>Count</td>
<td>Job Flows</td>
<td>1</td>
</tr>
<tr class="odd">
<td>FrmJbLsS</td>
<td>FJD</td>
<td>sFrmJbLsS</td>
<td>Firm Job Loss (Stable)</td>
<td>Estimated number of full-quarter jobs lost at firms</td>
<td>Count</td>
<td>Job Flows</td>
<td>1</td>
</tr>
<tr class="even">
<td>FrmJbCS</td>
<td>FJF</td>
<td>sFrmJbCS</td>
<td>Firm Job Change (Stable; Net Change)</td>
<td>Net growth in jobs that last a full quarter</td>
<td>Count</td>
<td>Job Flows</td>
<td>1</td>
</tr>
<tr class="odd">
<td>EarnS</td>
<td>ZW3</td>
<td>sEarnS</td>
<td>Average Monthly Earnings (Full-Quarter Employment)</td>
<td>Average monthly earnings of employees with stable jobs</td>
<td>Dollars</td>
<td>Earnings</td>
<td>EmpS</td>
</tr>
<tr class="even">
<td>EarnBeg</td>
<td>ZW2B</td>
<td>sEarnBeg</td>
<td>Average Monthly Earnings (Beginning-of-Quarter Employment)</td>
<td>Average monthly earnings of employees who worked on the first day of the reference quarter</td>
<td>Dollars</td>
<td>Earnings</td>
<td>Emp</td>
</tr>
<tr class="odd">
<td>EarnHirAS</td>
<td>ZWFA</td>
<td>sEarnHirAS</td>
<td>Average Monthly Earnings (All Hires into Full-Quarter Employment)</td>
<td>Average monthly earnings for workers who started a job that turned into a job lasting a full quarter</td>
<td>Dollars</td>
<td>Earnings</td>
<td>HirAS</td>
</tr>
<tr class="even">
<td>EarnHirNS</td>
<td>ZWFH</td>
<td>sEarnHirNS</td>
<td>Average Monthly Earnings (New Hires into Full-Quarter Employment)</td>
<td>Average monthly earnings of newly stable employees</td>
<td>Dollars</td>
<td>Earnings</td>
<td>HirNS</td>
</tr>
<tr class="odd">
<td>EarnSepS</td>
<td>ZWFS</td>
<td>sEarnSepS</td>
<td>Average Monthly Earnings (Flows out of Full-Quarter Employment)</td>
<td>Average monthly earnings of separations from full-quarter status at an establishment</td>
<td>Dollars</td>
<td>Earnings</td>
<td>SepSnx</td>
</tr>
<tr class="even">
<td>Payroll</td>
<td>W1</td>
<td>sPayroll</td>
<td>Total Quarterly Payroll</td>
<td>Total quarterly payroll for all jobs</td>
<td>Dollars</td>
<td>Earnings</td>
<td>1</td>
</tr>
</tbody>
</table>
<p><em>Source: <a href="https://lehd.ces.census.gov/data/schema/V4.12.0/lehd_public_use_schema.html">LEHD Public Use Schema</a></em></p>
</details>
<p>The categorical variables show us additional levels of detail that we can ge, beyond the basic aggregates.</p>
<details>
<summary>
<strong>Categorical Variables Table</strong> (Click to Expand)
</summary>
<p><strong>5.1. Agegrp</strong></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th><strong>agegrp</strong></th>
<th><strong>Label</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>A00</td>
<td>All Ages (14-99)</td>
</tr>
<tr class="even">
<td>A01</td>
<td>14-18</td>
</tr>
<tr class="odd">
<td>A02</td>
<td>19-21</td>
</tr>
<tr class="even">
<td>A03</td>
<td>22-24</td>
</tr>
<tr class="odd">
<td>A04</td>
<td>25-34</td>
</tr>
<tr class="even">
<td>A05</td>
<td>35-44</td>
</tr>
<tr class="odd">
<td>A06</td>
<td>45-54</td>
</tr>
<tr class="even">
<td>A07</td>
<td>55-64</td>
</tr>
<tr class="odd">
<td>A08</td>
<td>65-99</td>
</tr>
</tbody>
</table>
<p><strong>5.2. Education</strong></p>
<table class="caption-top table">
<colgroup>
<col style="width: 20%">
<col style="width: 80%">
</colgroup>
<thead>
<tr class="header">
<th><strong>education</strong></th>
<th><strong>Label</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>E0</td>
<td>All Education Categories</td>
</tr>
<tr class="even">
<td>E1</td>
<td>Less than high school</td>
</tr>
<tr class="odd">
<td>E2</td>
<td>High school or equivalent, no college</td>
</tr>
<tr class="even">
<td>E3</td>
<td>Some college or Associate degree</td>
</tr>
<tr class="odd">
<td>E4</td>
<td>Bachelor’s degree or advanced degree</td>
</tr>
<tr class="even">
<td>E5</td>
<td>Educational attainment not available (workers &lt; 24)</td>
</tr>
</tbody>
</table>
<p><strong>5.3. Ethnicity</strong></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th><strong>ethnicity</strong></th>
<th><strong>Label</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>A0</td>
<td>All Ethnicities</td>
</tr>
<tr class="even">
<td>A1</td>
<td>Not Hispanic or Latino</td>
</tr>
<tr class="odd">
<td>A2</td>
<td>Hispanic or Latino</td>
</tr>
</tbody>
</table>
<p><strong>5.4. Firmage</strong></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th><strong>firmage</strong></th>
<th><strong>Label</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>All Firm Ages</td>
</tr>
<tr class="even">
<td>1</td>
<td>0-1 Years</td>
</tr>
<tr class="odd">
<td>2</td>
<td>2-3 Years</td>
</tr>
<tr class="even">
<td>3</td>
<td>4-5 Years</td>
</tr>
<tr class="odd">
<td>4</td>
<td>6-10 Years</td>
</tr>
<tr class="even">
<td>5</td>
<td>11+ Years</td>
</tr>
<tr class="odd">
<td>N</td>
<td>Firm Age Not Available</td>
</tr>
</tbody>
</table>
<p><strong>5.5. Firmsize</strong></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th><strong>firmsize</strong></th>
<th><strong>Label</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>All Firm Sizes</td>
</tr>
<tr class="even">
<td>1</td>
<td>0-19 Employees</td>
</tr>
<tr class="odd">
<td>2</td>
<td>20-49 Employees</td>
</tr>
<tr class="even">
<td>3</td>
<td>50-249 Employees</td>
</tr>
<tr class="odd">
<td>4</td>
<td>250-499 Employees</td>
</tr>
<tr class="even">
<td>5</td>
<td>500+ Employees</td>
</tr>
<tr class="odd">
<td>N</td>
<td>Firm Size Not Available</td>
</tr>
</tbody>
</table>
<p><strong>5.6. Ownercode</strong></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th><strong>ownercode</strong></th>
<th><strong>Label</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>A00</td>
<td>State and local government + private</td>
</tr>
<tr class="even">
<td>A01</td>
<td>Federal government</td>
</tr>
<tr class="odd">
<td>A05</td>
<td>All Private</td>
</tr>
</tbody>
</table>
<p><strong>5.7. Periodicity</strong></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th><strong>periodicity</strong></th>
<th><strong>Label</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>A</td>
<td>Annual data</td>
</tr>
<tr class="even">
<td>Q</td>
<td>Quarterly data</td>
</tr>
</tbody>
</table>
<p><strong>5.8. Quarter</strong></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th><strong>quarter</strong></th>
<th><strong>Label</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>1st Quarter (Jan-Mar)</td>
</tr>
<tr class="even">
<td>2</td>
<td>2nd Quarter (Apr-Jun)</td>
</tr>
<tr class="odd">
<td>3</td>
<td>3rd Quarter (Jul-Sep)</td>
</tr>
<tr class="even">
<td>4</td>
<td>4th Quarter (Oct-Dec)</td>
</tr>
</tbody>
</table>
<p><strong>5.9. Race</strong></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th><strong>race</strong></th>
<th><strong>Label</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>A0</td>
<td>All Races</td>
</tr>
<tr class="even">
<td>A1</td>
<td>White Alone</td>
</tr>
<tr class="odd">
<td>A2</td>
<td>Black or African American Alone</td>
</tr>
<tr class="even">
<td>A3</td>
<td>American Indian or Alaska Native Alone</td>
</tr>
<tr class="odd">
<td>A4</td>
<td>Asian Alone</td>
</tr>
<tr class="even">
<td>A5</td>
<td>Native Hawaiian or Other Pacific Islander</td>
</tr>
<tr class="odd">
<td>A6</td>
<td>Some Other Race Alone (Not Used)</td>
</tr>
<tr class="even">
<td>A7</td>
<td>Two or More Race Groups</td>
</tr>
</tbody>
</table>
<p><strong>5.10. Seasonadj</strong></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th><strong>seasonadj</strong></th>
<th><strong>Label</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>S</td>
<td>Seasonally adjusted</td>
</tr>
<tr class="even">
<td>U</td>
<td>Not seasonally adjusted</td>
</tr>
</tbody>
</table>
<p><strong>5.11. Sex</strong></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th><strong>sex</strong></th>
<th><strong>Label</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>All Sexes</td>
</tr>
<tr class="even">
<td>1</td>
<td>Male</td>
</tr>
<tr class="odd">
<td>2</td>
<td>Female</td>
</tr>
</tbody>
</table>
<p><strong>5.12.1. Industry Levels</strong></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th><strong>ind_level</strong></th>
<th><strong>Label</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>A</td>
<td>All Industries</td>
</tr>
<tr class="even">
<td>S</td>
<td>NAICS Sectors</td>
</tr>
<tr class="odd">
<td>3</td>
<td>NAICS Subsectors</td>
</tr>
<tr class="even">
<td>4</td>
<td>NAICS Industry Groups</td>
</tr>
</tbody>
</table>
<p><strong>5.12.2. Industry</strong></p>
<table class="caption-top table">
<colgroup>
<col style="width: 16%">
<col style="width: 66%">
<col style="width: 17%">
</colgroup>
<thead>
<tr class="header">
<th><strong>industry</strong></th>
<th><strong>Label</strong></th>
<th><strong>ind_level</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>00</td>
<td>All NAICS Sectors</td>
<td>A</td>
</tr>
<tr class="even">
<td>000</td>
<td>All NAICS Subsectors</td>
<td>A</td>
</tr>
<tr class="odd">
<td>0000</td>
<td>All NAICS Industry Groups</td>
<td>A</td>
</tr>
<tr class="even">
<td>11</td>
<td>Agriculture, Forestry, Fishing and Hunting</td>
<td>S</td>
</tr>
<tr class="odd">
<td>111</td>
<td>Crop Production</td>
<td>3</td>
</tr>
<tr class="even">
<td>1111</td>
<td>Oilseed and Grain Farming</td>
<td>4</td>
</tr>
<tr class="odd">
<td>1112</td>
<td>Vegetable and Melon Farming</td>
<td>4</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>2383</td>
<td>Building Finishing Contractors</td>
<td>4</td>
</tr>
<tr class="even">
<td>2389</td>
<td>Other Specialty Trade Contractors</td>
<td>4</td>
</tr>
<tr class="odd">
<td>31-33</td>
<td>Manufacturing</td>
<td>S</td>
</tr>
<tr class="even">
<td>311</td>
<td>Food Manufacturing</td>
<td>3</td>
</tr>
<tr class="odd">
<td>3111</td>
<td>Animal Food Manufacturing</td>
<td>4</td>
</tr>
<tr class="even">
<td>3112</td>
<td>Grain and Oilseed Milling</td>
<td>4</td>
</tr>
<tr class="odd">
<td>3113</td>
<td>Sugar and Confectionery Product Manufacturing</td>
<td>4</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
</tbody>
</table>
<p><strong>5.13. Degree Level</strong></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th><strong>degree_level</strong></th>
<th><strong>Label</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>00</td>
<td>All Degree Levels</td>
</tr>
<tr class="even">
<td>01</td>
<td>Certificate &lt; 1 year</td>
</tr>
<tr class="odd">
<td>02</td>
<td>Certificate 1-2 years</td>
</tr>
<tr class="even">
<td>03</td>
<td>Associate’s Degree</td>
</tr>
<tr class="odd">
<td>04</td>
<td>Certificate 2-4 years</td>
</tr>
<tr class="even">
<td>05</td>
<td>Baccalaureate</td>
</tr>
<tr class="odd">
<td>06</td>
<td>Post-Baccalaureate Certificate</td>
</tr>
<tr class="even">
<td>07</td>
<td>Master’s Degree</td>
</tr>
<tr class="odd">
<td>08</td>
<td>Post-Master’s Certificate</td>
</tr>
<tr class="even">
<td>17</td>
<td>Doctoral - Research/Scholarship</td>
</tr>
<tr class="odd">
<td>18</td>
<td>Doctoral - Professional Practice</td>
</tr>
</tbody>
</table>
<p><em>Source: <a href="https://lehd.ces.census.gov/data/schema/V4.12.0/lehd_public_use_schema.html">LEHD Public Use Schema</a></em></p>
<details>
</details></details></section>
<section id="first-analysis" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="first-analysis"><span class="header-section-number">1.2</span> First Analysis</h2>
<p>Let us further filter the data because we are only interested in the aggregate series for now.</p>
<div id="view_the_data" class="cell" data-execution_count="4">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Create date variable</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>df_qwi_filtered <span class="op">=</span> df_qwi[</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    (df_qwi[<span class="st">"sex"</span>] <span class="op">==</span> <span class="dv">0</span>) <span class="op">&amp;</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    (df_qwi[<span class="st">"agegrp"</span>] <span class="op">==</span> <span class="st">"A00"</span>) <span class="op">&amp;</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    (df_qwi[<span class="st">"industry"</span>] <span class="op">==</span> <span class="st">"00"</span>) <span class="op">&amp;</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    (df_qwi[<span class="st">"ind_level"</span>] <span class="op">==</span> <span class="st">"A"</span>)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>].copy()  <span class="co"># Copy to avoid modifying the original DataFrame</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>df_qwi_filtered[<span class="st">"date"</span>] <span class="op">=</span> pd.PeriodIndex(</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    df_qwi_filtered[<span class="st">"year"</span>].astype(<span class="bu">str</span>) <span class="op">+</span> <span class="st">"Q"</span> <span class="op">+</span> df_qwi_filtered[<span class="st">"quarter"</span>].astype(<span class="bu">str</span>),</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    freq<span class="op">=</span><span class="st">"Q"</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>).to_timestamp()</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop unnecessary columns</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>df_qwi_filtered.drop(columns<span class="op">=</span>[<span class="st">"periodicity"</span>, <span class="st">"seasonadj"</span>, <span class="st">"geo_level"</span>, <span class="st">"ind_level"</span>, <span class="st">"industry"</span>,</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"ownercode"</span>, <span class="st">"sex"</span>, <span class="st">"agegrp"</span>, <span class="st">"race"</span>, <span class="st">"ethnicity"</span>, <span class="st">"education"</span>,</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"firmage"</span>, <span class="st">"firmsize"</span>, <span class="st">"year"</span>, <span class="st">"quarter"</span>, <span class="st">"geography"</span>], inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure "date" is the first column</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>df_qwi_filtered <span class="op">=</span> df_qwi_filtered[[<span class="st">"date"</span>] <span class="op">+</span> [col <span class="cf">for</span> col <span class="kw">in</span> df_qwi_filtered.columns <span class="cf">if</span> col <span class="op">!=</span> <span class="st">"date"</span>]]</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Export to deseasonalize in R</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>df_qwi_filtered.to_csv(<span class="st">"temp_df.csv"</span>, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Data filtered and ready for deseasonalization."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Data filtered and ready for deseasonalization.</code></pre>
</div>
</div>
<p>It turns out that we need to use R (together with python) to use the usual seasonal adjustment with X13-ARIMA.</p>
<div id="seasonal_adjustment" class="cell" data-execution_count="5">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> subprocess</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Run the R script</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>subprocess.run([<span class="st">"Rscript"</span>, <span class="st">"sheet_seas_adjust.r"</span>], check<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Clean up by deleting the temp file</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>os.remove(<span class="st">"temp_df.csv"</span>)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Data deseasonalized successfully."</span>)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="co"># We still need some data from FRED</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Data deseasonalized successfully.</code></pre>
</div>
</div>
<div id="figure_templates" class="cell" data-execution_count="6">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the adjusted data</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>df_qwi_filtered <span class="op">=</span> pd.read_csv(<span class="st">"qwi_data_seasadj.csv"</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co">## Plotting</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.dates <span class="im">as</span> mdates</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.ioff()  # Plots only show when explicitly called in quarto</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="co">## Single Time Series</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> fun_plot_single_ts(df, date_col, value_col, title<span class="op">=</span><span class="st">"Time Series Plot"</span>, xlabel<span class="op">=</span><span class="st">"Date"</span>, ylabel<span class="op">=</span><span class="st">"Value"</span>, color<span class="op">=</span><span class="st">"#023047"</span>, recession_shading<span class="op">=</span><span class="va">True</span>, recessions<span class="op">=</span><span class="va">None</span>, scale_factor<span class="op">=</span><span class="dv">1</span>):</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert date column to datetime format</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>    df[date_col] <span class="op">=</span> pd.to_datetime(df[date_col])</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Define default recession periods if none are provided</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> recessions <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>        recessions <span class="op">=</span> [</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>            (<span class="st">"2001-03-01"</span>, <span class="st">"2001-11-01"</span>),</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>            (<span class="st">"2007-12-01"</span>, <span class="st">"2009-06-01"</span>),</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>            (<span class="st">"2020-02-01"</span>, <span class="st">"2020-04-01"</span>)</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert recession dates to datetime format</span></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>    recession_periods <span class="op">=</span> [(datetime.strptime(start, <span class="st">"%Y-%m-</span><span class="sc">%d</span><span class="st">"</span>), datetime.strptime(end, <span class="st">"%Y-%m-</span><span class="sc">%d</span><span class="st">"</span>)) <span class="cf">for</span> start, end <span class="kw">in</span> recessions]</span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Apply scaling</span></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>    df[value_col] <span class="op">/=</span> scale_factor</span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create the figure and axis</span></span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Plot the time series</span></span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>    ax.plot(df[date_col], df[value_col], color<span class="op">=</span>color, linewidth<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="st">'_nolegend_'</span>)</span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Highlight recession periods with lighter shading</span></span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> recession_shading:</span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> start, end <span class="kw">in</span> recession_periods:</span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a>            ax.axvspan(start, end, color<span class="op">=</span><span class="st">"grey"</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Labels and title</span></span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a>    ax.set_xlabel(xlabel, fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">"bold"</span>)</span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a>    ax.set_ylabel(ylabel, fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">"bold"</span>)</span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a>    ax.set_title(title, fontsize<span class="op">=</span><span class="dv">16</span>, fontweight<span class="op">=</span><span class="st">"bold"</span>)</span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Improve readability</span></span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a>    ax.xaxis.set_major_locator(mdates.YearLocator(base<span class="op">=</span><span class="dv">5</span>))  <span class="co"># Show every 5 years</span></span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a>    ax.xaxis.set_major_formatter(mdates.DateFormatter(<span class="st">"%Y"</span>))</span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a>    ax.tick_params(axis<span class="op">=</span><span class="st">'x'</span>, rotation<span class="op">=</span><span class="dv">45</span>, labelsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true" tabindex="-1"></a>    ax.tick_params(axis<span class="op">=</span><span class="st">'y'</span>, labelsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb7-55"><a href="#cb7-55" aria-hidden="true" tabindex="-1"></a>    ax.grid(<span class="va">False</span>)  <span class="co"># Remove grid</span></span>
<span id="cb7-56"><a href="#cb7-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-57"><a href="#cb7-57" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Adjust layout</span></span>
<span id="cb7-58"><a href="#cb7-58" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb7-59"><a href="#cb7-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-60"><a href="#cb7-60" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Show the plot</span></span>
<span id="cb7-61"><a href="#cb7-61" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb7-62"><a href="#cb7-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-63"><a href="#cb7-63" aria-hidden="true" tabindex="-1"></a><span class="co">## Three Time Series</span></span>
<span id="cb7-64"><a href="#cb7-64" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> fun_plot_three_ts(df, date_col, value_col1, value_col2, value_col3, title<span class="op">=</span><span class="st">"Time Series Plot"</span>, xlabel<span class="op">=</span><span class="st">"Date"</span>, ylabel<span class="op">=</span><span class="st">"Value"</span>, color1<span class="op">=</span><span class="st">"#023047"</span>, color2<span class="op">=</span><span class="st">"#34a937"</span>, color3<span class="op">=</span><span class="st">"#bc5090"</span>, line_type2<span class="op">=</span><span class="st">"solid"</span>, line_type3<span class="op">=</span><span class="st">"dashed"</span>, recession_shading<span class="op">=</span><span class="va">True</span>, recessions<span class="op">=</span><span class="va">None</span>, legend1<span class="op">=</span><span class="st">"Series 1"</span>, legend2<span class="op">=</span><span class="st">"Series 2"</span>, legend3<span class="op">=</span><span class="st">"Series 3"</span>, scale_factor<span class="op">=</span><span class="dv">1</span>):</span>
<span id="cb7-65"><a href="#cb7-65" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert date column to datetime format</span></span>
<span id="cb7-66"><a href="#cb7-66" aria-hidden="true" tabindex="-1"></a>    df[date_col] <span class="op">=</span> pd.to_datetime(df[date_col])</span>
<span id="cb7-67"><a href="#cb7-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-68"><a href="#cb7-68" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Define default recession periods if none are provided</span></span>
<span id="cb7-69"><a href="#cb7-69" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> recessions <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb7-70"><a href="#cb7-70" aria-hidden="true" tabindex="-1"></a>        recessions <span class="op">=</span> [</span>
<span id="cb7-71"><a href="#cb7-71" aria-hidden="true" tabindex="-1"></a>            (<span class="st">"2001-03-01"</span>, <span class="st">"2001-11-01"</span>),</span>
<span id="cb7-72"><a href="#cb7-72" aria-hidden="true" tabindex="-1"></a>            (<span class="st">"2007-12-01"</span>, <span class="st">"2009-06-01"</span>),</span>
<span id="cb7-73"><a href="#cb7-73" aria-hidden="true" tabindex="-1"></a>            (<span class="st">"2020-02-01"</span>, <span class="st">"2020-04-01"</span>)</span>
<span id="cb7-74"><a href="#cb7-74" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb7-75"><a href="#cb7-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-76"><a href="#cb7-76" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert recession dates to datetime format</span></span>
<span id="cb7-77"><a href="#cb7-77" aria-hidden="true" tabindex="-1"></a>    recession_periods <span class="op">=</span> [(datetime.strptime(start, <span class="st">"%Y-%m-</span><span class="sc">%d</span><span class="st">"</span>), datetime.strptime(end, <span class="st">"%Y-%m-</span><span class="sc">%d</span><span class="st">"</span>)) <span class="cf">for</span> start, end <span class="kw">in</span> recessions]</span>
<span id="cb7-78"><a href="#cb7-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-79"><a href="#cb7-79" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Apply scaling</span></span>
<span id="cb7-80"><a href="#cb7-80" aria-hidden="true" tabindex="-1"></a>    df[value_col1] <span class="op">/=</span> scale_factor</span>
<span id="cb7-81"><a href="#cb7-81" aria-hidden="true" tabindex="-1"></a>    df[value_col2] <span class="op">/=</span> scale_factor</span>
<span id="cb7-82"><a href="#cb7-82" aria-hidden="true" tabindex="-1"></a>    df[value_col3] <span class="op">/=</span> scale_factor</span>
<span id="cb7-83"><a href="#cb7-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-84"><a href="#cb7-84" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create the figure and axis</span></span>
<span id="cb7-85"><a href="#cb7-85" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb7-86"><a href="#cb7-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-87"><a href="#cb7-87" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Plot the three time series</span></span>
<span id="cb7-88"><a href="#cb7-88" aria-hidden="true" tabindex="-1"></a>    ax.plot(df[date_col], df[value_col1], color<span class="op">=</span>color1, linewidth<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span>legend1)</span>
<span id="cb7-89"><a href="#cb7-89" aria-hidden="true" tabindex="-1"></a>    ax.plot(df[date_col], df[value_col2], color<span class="op">=</span>color2, linewidth<span class="op">=</span><span class="dv">2</span>, linestyle<span class="op">=</span>line_type2, label<span class="op">=</span>legend2)</span>
<span id="cb7-90"><a href="#cb7-90" aria-hidden="true" tabindex="-1"></a>    ax.plot(df[date_col], df[value_col3], color<span class="op">=</span>color3, linewidth<span class="op">=</span><span class="dv">2</span>, linestyle<span class="op">=</span>line_type3, label<span class="op">=</span>legend3)</span>
<span id="cb7-91"><a href="#cb7-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-92"><a href="#cb7-92" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Highlight recession periods with lighter shading</span></span>
<span id="cb7-93"><a href="#cb7-93" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> recession_shading:</span>
<span id="cb7-94"><a href="#cb7-94" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> start, end <span class="kw">in</span> recession_periods:</span>
<span id="cb7-95"><a href="#cb7-95" aria-hidden="true" tabindex="-1"></a>            ax.axvspan(start, end, color<span class="op">=</span><span class="st">"grey"</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb7-96"><a href="#cb7-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-97"><a href="#cb7-97" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Labels and title</span></span>
<span id="cb7-98"><a href="#cb7-98" aria-hidden="true" tabindex="-1"></a>    ax.set_xlabel(xlabel, fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">"bold"</span>)</span>
<span id="cb7-99"><a href="#cb7-99" aria-hidden="true" tabindex="-1"></a>    ax.set_ylabel(ylabel, fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">"bold"</span>)</span>
<span id="cb7-100"><a href="#cb7-100" aria-hidden="true" tabindex="-1"></a>    ax.set_title(title, fontsize<span class="op">=</span><span class="dv">16</span>, fontweight<span class="op">=</span><span class="st">"bold"</span>)</span>
<span id="cb7-101"><a href="#cb7-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-102"><a href="#cb7-102" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Improve readability</span></span>
<span id="cb7-103"><a href="#cb7-103" aria-hidden="true" tabindex="-1"></a>    ax.xaxis.set_major_locator(mdates.YearLocator(base<span class="op">=</span><span class="dv">5</span>))  <span class="co"># Show every 5 years</span></span>
<span id="cb7-104"><a href="#cb7-104" aria-hidden="true" tabindex="-1"></a>    ax.xaxis.set_major_formatter(mdates.DateFormatter(<span class="st">"%Y"</span>))</span>
<span id="cb7-105"><a href="#cb7-105" aria-hidden="true" tabindex="-1"></a>    ax.tick_params(axis<span class="op">=</span><span class="st">'x'</span>, rotation<span class="op">=</span><span class="dv">45</span>, labelsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb7-106"><a href="#cb7-106" aria-hidden="true" tabindex="-1"></a>    ax.tick_params(axis<span class="op">=</span><span class="st">'y'</span>, labelsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb7-107"><a href="#cb7-107" aria-hidden="true" tabindex="-1"></a>    ax.grid(<span class="va">False</span>)  <span class="co"># Remove grid</span></span>
<span id="cb7-108"><a href="#cb7-108" aria-hidden="true" tabindex="-1"></a>    ax.legend()</span>
<span id="cb7-109"><a href="#cb7-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-110"><a href="#cb7-110" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Adjust layout</span></span>
<span id="cb7-111"><a href="#cb7-111" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb7-112"><a href="#cb7-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-113"><a href="#cb7-113" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Show the plot</span></span>
<span id="cb7-114"><a href="#cb7-114" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb7-115"><a href="#cb7-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-116"><a href="#cb7-116" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> fun_plot_bar_three_line(df, date_col, bar_col1, bar_col2, bar_col3, line_col, title<span class="op">=</span><span class="st">"Time Series Plot"</span>, xlabel<span class="op">=</span><span class="st">"Date"</span>, ylabel<span class="op">=</span><span class="st">"Primary Value"</span>, color_bar1<span class="op">=</span><span class="st">"#bc5090"</span>, color_bar2<span class="op">=</span><span class="st">"#58508d"</span>, color_bar3<span class="op">=</span><span class="st">"#003f5c"</span>, color_line<span class="op">=</span><span class="st">"#ffa600"</span>, recession_shading<span class="op">=</span><span class="va">True</span>, recessions<span class="op">=</span><span class="va">None</span>, scale_factor<span class="op">=</span><span class="dv">1</span>):</span>
<span id="cb7-117"><a href="#cb7-117" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert date column to datetime format</span></span>
<span id="cb7-118"><a href="#cb7-118" aria-hidden="true" tabindex="-1"></a>    df[date_col] <span class="op">=</span> pd.to_datetime(df[date_col])</span>
<span id="cb7-119"><a href="#cb7-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-120"><a href="#cb7-120" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Define default recession periods if none are provided</span></span>
<span id="cb7-121"><a href="#cb7-121" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> recessions <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb7-122"><a href="#cb7-122" aria-hidden="true" tabindex="-1"></a>        recessions <span class="op">=</span> [</span>
<span id="cb7-123"><a href="#cb7-123" aria-hidden="true" tabindex="-1"></a>            (<span class="st">"2001-03-01"</span>, <span class="st">"2001-11-01"</span>),</span>
<span id="cb7-124"><a href="#cb7-124" aria-hidden="true" tabindex="-1"></a>            (<span class="st">"2007-12-01"</span>, <span class="st">"2009-06-01"</span>),</span>
<span id="cb7-125"><a href="#cb7-125" aria-hidden="true" tabindex="-1"></a>            (<span class="st">"2020-02-01"</span>, <span class="st">"2020-04-01"</span>)</span>
<span id="cb7-126"><a href="#cb7-126" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb7-127"><a href="#cb7-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-128"><a href="#cb7-128" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert recession dates to datetime format</span></span>
<span id="cb7-129"><a href="#cb7-129" aria-hidden="true" tabindex="-1"></a>    recession_periods <span class="op">=</span> [(datetime.strptime(start, <span class="st">"%Y-%m-</span><span class="sc">%d</span><span class="st">"</span>), datetime.strptime(end, <span class="st">"%Y-%m-</span><span class="sc">%d</span><span class="st">"</span>)) <span class="cf">for</span> start, end <span class="kw">in</span> recessions]</span>
<span id="cb7-130"><a href="#cb7-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-131"><a href="#cb7-131" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Apply scaling</span></span>
<span id="cb7-132"><a href="#cb7-132" aria-hidden="true" tabindex="-1"></a>    df[bar_col1] <span class="op">/=</span> scale_factor</span>
<span id="cb7-133"><a href="#cb7-133" aria-hidden="true" tabindex="-1"></a>    df[bar_col2] <span class="op">/=</span> scale_factor</span>
<span id="cb7-134"><a href="#cb7-134" aria-hidden="true" tabindex="-1"></a>    df[bar_col3] <span class="op">/=</span> scale_factor</span>
<span id="cb7-135"><a href="#cb7-135" aria-hidden="true" tabindex="-1"></a>    df[line_col] <span class="op">/=</span> scale_factor</span>
<span id="cb7-136"><a href="#cb7-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-137"><a href="#cb7-137" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create the figure and axis</span></span>
<span id="cb7-138"><a href="#cb7-138" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb7-139"><a href="#cb7-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-140"><a href="#cb7-140" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Plot stacked bars</span></span>
<span id="cb7-141"><a href="#cb7-141" aria-hidden="true" tabindex="-1"></a>    ax.bar(df[date_col], df[bar_col1], color<span class="op">=</span>color_bar1, label<span class="op">=</span>bar_col1)</span>
<span id="cb7-142"><a href="#cb7-142" aria-hidden="true" tabindex="-1"></a>    ax.bar(df[date_col], df[bar_col2], bottom<span class="op">=</span>df[bar_col1], color<span class="op">=</span>color_bar2, label<span class="op">=</span>bar_col2)</span>
<span id="cb7-143"><a href="#cb7-143" aria-hidden="true" tabindex="-1"></a>    ax.bar(df[date_col], df[bar_col3], bottom<span class="op">=</span>df[bar_col1] <span class="op">+</span> df[bar_col2], color<span class="op">=</span>color_bar3, label<span class="op">=</span>bar_col3)</span>
<span id="cb7-144"><a href="#cb7-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-145"><a href="#cb7-145" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Plot the line series</span></span>
<span id="cb7-146"><a href="#cb7-146" aria-hidden="true" tabindex="-1"></a>    ax2 <span class="op">=</span> ax.twinx()</span>
<span id="cb7-147"><a href="#cb7-147" aria-hidden="true" tabindex="-1"></a>    ax2.plot(df[date_col], df[line_col], color<span class="op">=</span>color_line, linewidth<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span>line_col)</span>
<span id="cb7-148"><a href="#cb7-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-149"><a href="#cb7-149" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Highlight recession periods with lighter shading</span></span>
<span id="cb7-150"><a href="#cb7-150" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> recession_shading:</span>
<span id="cb7-151"><a href="#cb7-151" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> start, end <span class="kw">in</span> recession_periods:</span>
<span id="cb7-152"><a href="#cb7-152" aria-hidden="true" tabindex="-1"></a>            ax.axvspan(start, end, color<span class="op">=</span><span class="st">"grey"</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb7-153"><a href="#cb7-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-154"><a href="#cb7-154" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Labels and title</span></span>
<span id="cb7-155"><a href="#cb7-155" aria-hidden="true" tabindex="-1"></a>    ax.set_xlabel(xlabel, fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">"bold"</span>)</span>
<span id="cb7-156"><a href="#cb7-156" aria-hidden="true" tabindex="-1"></a>    ax.set_ylabel(ylabel, fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">"bold"</span>)</span>
<span id="cb7-157"><a href="#cb7-157" aria-hidden="true" tabindex="-1"></a>    ax.set_title(title, fontsize<span class="op">=</span><span class="dv">16</span>, fontweight<span class="op">=</span><span class="st">"bold"</span>)</span>
<span id="cb7-158"><a href="#cb7-158" aria-hidden="true" tabindex="-1"></a>    ax2.set_ylabel(<span class="st">"Secondary Value"</span>, fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">"bold"</span>)</span>
<span id="cb7-159"><a href="#cb7-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-160"><a href="#cb7-160" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Improve readability</span></span>
<span id="cb7-161"><a href="#cb7-161" aria-hidden="true" tabindex="-1"></a>    ax.xaxis.set_major_locator(mdates.YearLocator(base<span class="op">=</span><span class="dv">5</span>))  <span class="co"># Show every 5 years</span></span>
<span id="cb7-162"><a href="#cb7-162" aria-hidden="true" tabindex="-1"></a>    ax.xaxis.set_major_formatter(mdates.DateFormatter(<span class="st">"%Y"</span>))</span>
<span id="cb7-163"><a href="#cb7-163" aria-hidden="true" tabindex="-1"></a>    ax.tick_params(axis<span class="op">=</span><span class="st">'x'</span>, rotation<span class="op">=</span><span class="dv">45</span>, labelsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb7-164"><a href="#cb7-164" aria-hidden="true" tabindex="-1"></a>    ax.tick_params(axis<span class="op">=</span><span class="st">'y'</span>, labelsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb7-165"><a href="#cb7-165" aria-hidden="true" tabindex="-1"></a>    ax.grid(<span class="va">False</span>)  <span class="co"># Remove grid</span></span>
<span id="cb7-166"><a href="#cb7-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-167"><a href="#cb7-167" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Adjust layout</span></span>
<span id="cb7-168"><a href="#cb7-168" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb7-169"><a href="#cb7-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-170"><a href="#cb7-170" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Show the plot</span></span>
<span id="cb7-171"><a href="#cb7-171" aria-hidden="true" tabindex="-1"></a>    plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="plot_series" class="cell" data-fig-show="none" data-execution_count="7">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="main_quarto_files/figure-html/plot_series-output-1.svg" id="plot_series-1" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="main_quarto_files/figure-html/plot_series-output-2.svg" id="plot_series-2" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="main_quarto_files/figure-html/plot_series-output-3.svg" id="plot_series-3" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="main_quarto_files/figure-html/plot_series-output-4.svg" id="plot_series-4" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="main_quarto_files/figure-html/plot_series-output-5.svg" id="plot_series-5" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="main_quarto_files/figure-html/plot_series-output-6.svg" id="plot_series-6" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="main_quarto_files/figure-html/plot_series-output-7.svg" id="plot_series-7" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="main_quarto_files/figure-html/plot_series-output-8.svg" id="plot_series-8" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="main_quarto_files/figure-html/plot_series-output-9.svg" id="plot_series-9" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="main_quarto_files/figure-html/plot_series-output-10.svg" id="plot_series-10" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="main_quarto_files/figure-html/plot_series-output-11.svg" id="plot_series-11" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="main_quarto_files/figure-html/plot_series-output-12.svg" id="plot_series-12" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="main_quarto_files/figure-html/plot_series-output-13.svg" id="plot_series-13" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="main_quarto_files/figure-html/plot_series-output-14.svg" id="plot_series-14" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="main_quarto_files/figure-html/plot_series-output-15.svg" id="plot_series-15" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div>

</div>
<div class="quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<a href="main_quarto_files/figure-html/plot_series-output-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-1"><img src="main_quarto_files/figure-html/plot_series-output-1.svg" class="img-fluid"></a>
<div style="font-size: 10px; width: 100%; text-align: justify;">
Notes.
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<a href="main_quarto_files/figure-html/plot_series-output-2.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-2"><img src="main_quarto_files/figure-html/plot_series-output-2.svg" class="img-fluid"></a>
<div style="font-size: 10px; width: 100%; text-align: justify;">
Notes.
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<a href="main_quarto_files/figure-html/plot_series-output-3.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-3"><img src="main_quarto_files/figure-html/plot_series-output-3.svg" class="img-fluid"></a>
<div style="font-size: 10px; width: 100%; text-align: justify;">
Notes.
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<p>HirA</p>
</div>
</div>
</div>
<p>Now that we know that the plots work and look ok, let</p>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<script>var lightboxQuarto = GLightbox({"descPosition":"bottom","selector":".lightbox","openEffect":"zoom","loop":false,"closeEffect":"zoom"});
(function() {
  let previousOnload = window.onload;
  window.onload = () => {
    if (previousOnload) {
      previousOnload();
    }
    lightboxQuarto.on('slide_before_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      const href = trigger.getAttribute('href');
      if (href !== null) {
        const imgEl = window.document.querySelector(`a[href="${href}"] img`);
        if (imgEl !== null) {
          const srcAttr = imgEl.getAttribute("src");
          if (srcAttr && srcAttr.startsWith("data:")) {
            slideConfig.href = srcAttr;
          }
        }
      } 
    });
  
    lightboxQuarto.on('slide_after_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(slideNode);
      }
    });
  
  };
  
})();
          </script>




<script src="main_quarto_files/libs/quarto-html/zenscroll-min.js"></script>
</body></html>